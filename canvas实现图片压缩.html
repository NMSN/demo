<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <div id="ad">
      <input class="update" type="file" />
    </div>
  </body>
  <script>
    const updateDom = document.getElementsByClassName("update")[0];
    updateDom.addEventListener("change", e => {
      const file = e.target.files[0];
      
      // 图片转成base64
      const reader = new FileReader();
      reader.readAsDataURL(file);

      reader.onload = function(e) {
        var fullImg = document.createElement("img");
        fullImg.src = e.target.result;

        fullImg.onload = () => {
          // 原图插入
          document.getElementById("ad").appendChild(fullImg);
          
          // 创建canvas元素
          let canvas = document.createElement("canvas");
          let context = canvas.getContext("2d");
          
          const canvasSize = { x: 200, y: 200 };

          // 限制画布和元素大小，画布即为最后转换成的图片
          canvas.width = canvasSize.x;
          canvas.height = canvasSize.y;
          context.drawImage(fullImg, 0, 0, canvasSize.x, canvasSize.y);
          const result = canvas.toDataURL();

          var thumbnail = document.createElement("img");
          thumbnail.src = result;
          thumbnail.onload = () => {
            document.getElementById("ad").appendChild(thumbnail);
          };
        };
      };
    });
  </script>
</html>
